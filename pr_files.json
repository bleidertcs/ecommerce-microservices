[
  {
    "sha": "5c2fbb36607ca3c3dea9e2198716711ccfbe79b3",
    "filename": ".devenv/docker/clickhouse/compose.yaml",
    "status": "modified",
    "additions": 15,
    "deletions": 23,
    "changes": 38,
    "blob_url": "https://github.com/SigNoz/signoz/blob/7d51eea14a232c9d4032ac76a8c1887c0138929f/.devenv%2Fdocker%2Fclickhouse%2Fcompose.yaml",
    "raw_url": "https://github.com/SigNoz/signoz/raw/7d51eea14a232c9d4032ac76a8c1887c0138929f/.devenv%2Fdocker%2Fclickhouse%2Fcompose.yaml",
    "contents_url": "https://api.github.com/repos/SigNoz/signoz/contents/.devenv%2Fdocker%2Fclickhouse%2Fcompose.yaml?ref=7d51eea14a232c9d4032ac76a8c1887c0138929f",
    "patch": "@@ -41,31 +41,23 @@ services:\n       interval: 30s\n       timeout: 5s\n       retries: 3\n-  schema-migrator-sync:\n-    image: signoz/signoz-schema-migrator:v0.142.0\n-    container_name: schema-migrator-sync\n-    command:\n-      - sync\n-      - --cluster-name=cluster\n-      - --dsn=tcp://clickhouse:9000\n-      - --replication=true\n-      - --up=\n-    depends_on:\n-      clickhouse:\n-        condition: service_healthy\n-    restart: on-failure\n-  schema-migrator-async:\n-    image: signoz/signoz-schema-migrator:v0.142.0\n-    container_name: schema-migrator-async\n+  telemetrystore-migrator:\n+    image: signoz/signoz-otel-collector:v0.142.0\n+    container_name: telemetrystore-migrator\n+    environment:\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n+    entrypoint:\n+      - /bin/sh\n     command:\n-      - async\n-      - --cluster-name=cluster\n-      - --dsn=tcp://clickhouse:9000\n-      - --replication=true\n-      - --up=\n+    - -c \n+    - |\n+      /signoz-otel-collector migrate bootstrap &&\n+      /signoz-otel-collector migrate sync up &&\n+      /signoz-otel-collector migrate async up\n     depends_on:\n       clickhouse:\n         condition: service_healthy\n-      schema-migrator-sync:\n-        condition: service_completed_successfully\n     restart: on-failure"
  },
  {
    "sha": "46e9ba60e8d06ca0cce0101c9693275af020afdd",
    "filename": ".devenv/docker/signoz-otel-collector/compose.yaml",
    "status": "modified",
    "additions": 11,
    "deletions": 2,
    "changes": 13,
    "blob_url": "https://github.com/SigNoz/signoz/blob/7d51eea14a232c9d4032ac76a8c1887c0138929f/.devenv%2Fdocker%2Fsignoz-otel-collector%2Fcompose.yaml",
    "raw_url": "https://github.com/SigNoz/signoz/raw/7d51eea14a232c9d4032ac76a8c1887c0138929f/.devenv%2Fdocker%2Fsignoz-otel-collector%2Fcompose.yaml",
    "contents_url": "https://api.github.com/repos/SigNoz/signoz/contents/.devenv%2Fdocker%2Fsignoz-otel-collector%2Fcompose.yaml?ref=7d51eea14a232c9d4032ac76a8c1887c0138929f",
    "patch": "@@ -1,14 +1,23 @@\n services:\n   signoz-otel-collector:\n-    image: signoz/signoz-otel-collector:v0.129.6\n+    image: signoz/signoz-otel-collector:v0.142.0\n     container_name: signoz-otel-collector-dev\n+    entrypoint:\n+    - /bin/sh\n     command:\n-      - --config=/etc/otel-collector-config.yaml\n+      - -c\n+      - |\n+        /signoz-otel-collector migrate sync check &&\n+        /signoz-otel-collector --config=/etc/otel-collector-config.yaml\n     volumes:\n       - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml\n     environment:\n       - OTEL_RESOURCE_ATTRIBUTES=host.name=signoz-host,os.type=linux\n       - LOW_CARDINAL_EXCEPTION_GROUPING=false\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n     ports:\n       - \"4317:4317\" # OTLP gRPC receiver\n       - \"4318:4318\" # OTLP HTTP receiver"
  },
  {
    "sha": "90473624be88dd39a79d138a7af8b9bb4bef164c",
    "filename": "conf/example.yaml",
    "status": "modified",
    "additions": 2,
    "deletions": 1,
    "changes": 3,
    "blob_url": "https://github.com/SigNoz/signoz/blob/7d51eea14a232c9d4032ac76a8c1887c0138929f/conf%2Fexample.yaml",
    "raw_url": "https://github.com/SigNoz/signoz/raw/7d51eea14a232c9d4032ac76a8c1887c0138929f/conf%2Fexample.yaml",
    "contents_url": "https://api.github.com/repos/SigNoz/signoz/contents/conf%2Fexample.yaml?ref=7d51eea14a232c9d4032ac76a8c1887c0138929f",
    "patch": "@@ -318,4 +318,5 @@ user:\n     # The password of the root user. Must meet password requirements.\n     password: \"\"\n     # The name of the organization to create or look up for the root user.\n-    org_name: default\n+    org:\n+      name: default"
  },
  {
    "sha": "388bc41f81497856c5a117baf5e8a830a9e52652",
    "filename": "deploy/docker-swarm/docker-compose.ha.yaml",
    "status": "modified",
    "additions": 70,
    "deletions": 45,
    "changes": 115,
    "blob_url": "https://github.com/SigNoz/signoz/blob/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker-swarm%2Fdocker-compose.ha.yaml",
    "raw_url": "https://github.com/SigNoz/signoz/raw/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker-swarm%2Fdocker-compose.ha.yaml",
    "contents_url": "https://api.github.com/repos/SigNoz/signoz/contents/deploy%2Fdocker-swarm%2Fdocker-compose.ha.yaml?ref=7d51eea14a232c9d4032ac76a8c1887c0138929f",
    "patch": "@@ -61,7 +61,6 @@ x-db-depend: &db-depend\n     - clickhouse\n     - clickhouse-2\n     - clickhouse-3\n-    - schema-migrator\n services:\n   init-clickhouse:\n     !!merge <<: *common\n@@ -136,12 +135,17 @@ services:\n     #   - \"9000:9000\"\n     #   - \"8123:8123\"\n     #   - \"9181:9181\"\n+    configs:\n+      - source: clickhouse-config\n+        target: /etc/clickhouse-server/config.xml\n+      - source: clickhouse-users\n+        target: /etc/clickhouse-server/users.xml\n+      - source: clickhouse-custom-function\n+        target: /etc/clickhouse-server/custom-function.xml\n+      - source: clickhouse-cluster\n+        target: /etc/clickhouse-server/config.d/cluster.ha.xml\n     volumes:\n-      - ../common/clickhouse/config.xml:/etc/clickhouse-server/config.xml\n-      - ../common/clickhouse/users.xml:/etc/clickhouse-server/users.xml\n-      - ../common/clickhouse/custom-function.xml:/etc/clickhouse-server/custom-function.xml\n       - ../common/clickhouse/user_scripts:/var/lib/clickhouse/user_scripts/\n-      - ../common/clickhouse/cluster.ha.xml:/etc/clickhouse-server/config.d/cluster.xml\n       - ./clickhouse-setup/data/clickhouse/:/var/lib/clickhouse/\n       # - ../common/clickhouse/storage.xml:/etc/clickhouse-server/config.d/storage.xml\n   clickhouse-2:\n@@ -151,12 +155,17 @@ services:\n     #   - \"9001:9000\"\n     #   - \"8124:8123\"\n     #   - \"9182:9181\"\n+    configs:\n+      - source: clickhouse-config\n+        target: /etc/clickhouse-server/config.xml\n+      - source: clickhouse-users\n+        target: /etc/clickhouse-server/users.xml\n+      - source: clickhouse-custom-function\n+        target: /etc/clickhouse-server/custom-function.xml\n+      - source: clickhouse-cluster\n+        target: /etc/clickhouse-server/config.d/cluster.ha.xml\n     volumes:\n-      - ../common/clickhouse/config.xml:/etc/clickhouse-server/config.xml\n-      - ../common/clickhouse/users.xml:/etc/clickhouse-server/users.xml\n-      - ../common/clickhouse/custom-function.xml:/etc/clickhouse-server/custom-function.xml\n       - ../common/clickhouse/user_scripts:/var/lib/clickhouse/user_scripts/\n-      - ../common/clickhouse/cluster.ha.xml:/etc/clickhouse-server/config.d/cluster.xml\n       - ./clickhouse-setup/data/clickhouse-2/:/var/lib/clickhouse/\n       # - ../common/clickhouse/storage.xml:/etc/clickhouse-server/config.d/storage.xml\n   clickhouse-3:\n@@ -166,37 +175,32 @@ services:\n     #   - \"9002:9000\"\n     #   - \"8125:8123\"\n     #   - \"9183:9181\"\n+    configs:\n+      - source: clickhouse-config\n+        target: /etc/clickhouse-server/config.xml\n+      - source: clickhouse-users\n+        target: /etc/clickhouse-server/users.xml\n+      - source: clickhouse-custom-function\n+        target: /etc/clickhouse-server/custom-function.xml\n+      - source: clickhouse-cluster\n+        target: /etc/clickhouse-server/config.d/cluster.ha.xml\n     volumes:\n-      - ../common/clickhouse/config.xml:/etc/clickhouse-server/config.xml\n-      - ../common/clickhouse/users.xml:/etc/clickhouse-server/users.xml\n-      - ../common/clickhouse/custom-function.xml:/etc/clickhouse-server/custom-function.xml\n       - ../common/clickhouse/user_scripts:/var/lib/clickhouse/user_scripts/\n-      - ../common/clickhouse/cluster.ha.xml:/etc/clickhouse-server/config.d/cluster.xml\n       - ./clickhouse-setup/data/clickhouse-3/:/var/lib/clickhouse/\n       # - ../common/clickhouse/storage.xml:/etc/clickhouse-server/config.d/storage.xml\n   signoz:\n     !!merge <<: *db-depend\n     image: signoz/signoz:v0.112.0\n-    command:\n-      - --config=/root/config/prometheus.yml\n     ports:\n       - \"8080:8080\" # signoz port\n     #   - \"6060:6060\"     # pprof port\n     volumes:\n-      - ../common/signoz/prometheus.yml:/root/config/prometheus.yml\n-      - ../common/dashboards:/root/config/dashboards\n       - ./clickhouse-setup/data/signoz/:/var/lib/signoz/\n     environment:\n       - SIGNOZ_ALERTMANAGER_PROVIDER=signoz\n       - SIGNOZ_TELEMETRYSTORE_CLICKHOUSE_DSN=tcp://clickhouse:9000\n       - SIGNOZ_SQLSTORE_SQLITE_PATH=/var/lib/signoz/signoz.db\n-      - DASHBOARDS_PATH=/root/config/dashboards\n-      - STORAGE=clickhouse\n-      - GODEBUG=netdns=go\n-      - TELEMETRY_ENABLED=true\n-      - DEPLOYMENT_TYPE=docker-swarm\n       - SIGNOZ_TOKENIZER_JWT_SECRET=secret\n-      - DOT_METRICS_ENABLED=true\n     healthcheck:\n       test:\n         - CMD\n@@ -210,39 +214,47 @@ services:\n   otel-collector:\n     !!merge <<: *db-depend\n     image: signoz/signoz-otel-collector:v0.142.0\n+    entrypoint:\n+    - /bin/sh\n     command:\n-      - --config=/etc/otel-collector-config.yaml\n-      - --manager-config=/etc/manager-config.yaml\n-      - --copy-path=/var/tmp/collector-config.yaml\n-    volumes:\n-      - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml\n-      - ../common/signoz/otel-collector-opamp-config.yaml:/etc/manager-config.yaml\n+      - -c\n+      - |\n+        /signoz-otel-collector migrate sync check &&\n+        /signoz-otel-collector --config=/etc/otel-collector-config.yaml --manager-config=/etc/manager-config.yaml --copy-path=/var/tmp/collector-config.yaml\n+    configs:\n+      - source: otel-collector-config\n+        target: /etc/otel-collector-config.yaml\n+      - source: otel-manager-config\n+        target: /etc/manager-config.yaml\n     environment:\n       - OTEL_RESOURCE_ATTRIBUTES=host.name={{.Node.Hostname}},os.type={{.Node.Platform.OS}}\n       - LOW_CARDINAL_EXCEPTION_GROUPING=false\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n     ports:\n       # - \"1777:1777\"     # pprof extension\n       - \"4317:4317\" # OTLP gRPC receiver\n       - \"4318:4318\" # OTLP HTTP receiver\n     deploy:\n       replicas: 3\n-    depends_on:\n-      - clickhouse\n-      - schema-migrator\n-      - signoz\n-  schema-migrator:\n-    !!merge <<: *common\n-    image: signoz/signoz-schema-migrator:v0.142.0\n-    deploy:\n-      restart_policy:\n-        condition: on-failure\n-        delay: 5s\n-    entrypoint: sh\n+  signoz-telemetrystore-migrator:\n+    !!merge <<: *db-depend\n+    image: signoz/signoz-otel-collector:${OTELCOL_TAG:-v0.142.0}\n+    environment:\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n+    entrypoint:\n+      - /bin/sh\n     command:\n-      - -c\n-      - \"/signoz-schema-migrator sync --dsn=tcp://clickhouse:9000 --up= && /signoz-schema-migrator async --dsn=tcp://clickhouse:9000 --up=\"\n-    depends_on:\n-      - clickhouse\n+    - -c \n+    - |\n+      /signoz-otel-collector migrate bootstrap &&\n+      /signoz-otel-collector migrate sync up &&\n+      /signoz-otel-collector migrate async up\n networks:\n   signoz-net:\n     name: signoz-net\n@@ -261,3 +273,16 @@ volumes:\n     name: signoz-zookeeper-2\n   zookeeper-3:\n     name: signoz-zookeeper-3\n+configs:\n+  clickhouse-config:\n+    file: ../common/clickhouse/config.xml\n+  clickhouse-users:\n+    file: ../common/clickhouse/users.xml\n+  clickhouse-custom-function:\n+    file: ../common/clickhouse/custom-function.xml\n+  clickhouse-cluster:\n+    file: ../common/clickhouse/cluster.ha.xml\n+  otel-collector-config:\n+    file: ./otel-collector-config.yaml\n+  otel-manager-config:\n+    file: ../common/signoz/otel-collector-opamp-config.yaml"
  },
  {
    "sha": "af403687c7d1ca1ecd9520e0ee9c8dfca92d8751",
    "filename": "deploy/docker-swarm/docker-compose.yaml",
    "status": "modified",
    "additions": 27,
    "deletions": 40,
    "changes": 67,
    "blob_url": "https://github.com/SigNoz/signoz/blob/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker-swarm%2Fdocker-compose.yaml",
    "raw_url": "https://github.com/SigNoz/signoz/raw/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker-swarm%2Fdocker-compose.yaml",
    "contents_url": "https://api.github.com/repos/SigNoz/signoz/contents/deploy%2Fdocker-swarm%2Fdocker-compose.yaml?ref=7d51eea14a232c9d4032ac76a8c1887c0138929f",
    "patch": "@@ -58,7 +58,6 @@ x-db-depend: &db-depend\n   !!merge <<: *common\n   depends_on:\n     - clickhouse\n-    - schema-migrator\n services:\n   init-clickhouse:\n     !!merge <<: *common\n@@ -114,30 +113,20 @@ services:\n         target: /etc/clickhouse-server/config.d/cluster.xml\n     volumes:\n       - clickhouse:/var/lib/clickhouse/\n+      - ../common/clickhouse/user_scripts:/var/lib/clickhouse/user_scripts/\n       # - ../common/clickhouse/storage.xml:/etc/clickhouse-server/config.d/storage.xml\n   signoz:\n     !!merge <<: *db-depend\n     image: signoz/signoz:v0.112.0\n-    command:\n-      - --config=/root/config/prometheus.yml\n     ports:\n       - \"8080:8080\" # signoz port\n-    #   - \"6060:6060\"     # pprof port\n     volumes:\n       - sqlite:/var/lib/signoz/\n-    configs:\n-      - source: signoz-prometheus-config\n-        target: /root/config/prometheus.yml\n     environment:\n       - SIGNOZ_ALERTMANAGER_PROVIDER=signoz\n       - SIGNOZ_TELEMETRYSTORE_CLICKHOUSE_DSN=tcp://clickhouse:9000\n       - SIGNOZ_SQLSTORE_SQLITE_PATH=/var/lib/signoz/signoz.db\n-      - DASHBOARDS_PATH=/root/config/dashboards\n-      - STORAGE=clickhouse\n-      - GODEBUG=netdns=go\n-      - TELEMETRY_ENABLED=true\n-      - DEPLOYMENT_TYPE=docker-swarm\n-      - DOT_METRICS_ENABLED=true\n+      - SIGNOZ_TOKENIZER_JWT_SECRET=secret\n     healthcheck:\n       test:\n         - CMD\n@@ -151,10 +140,13 @@ services:\n   otel-collector:\n     !!merge <<: *db-depend\n     image: signoz/signoz-otel-collector:v0.142.0\n+    entrypoint:\n+    - /bin/sh\n     command:\n-      - --config=/etc/otel-collector-config.yaml\n-      - --manager-config=/etc/manager-config.yaml\n-      - --copy-path=/var/tmp/collector-config.yaml\n+      - -c\n+      - |\n+        /signoz-otel-collector migrate sync check &&\n+        /signoz-otel-collector --config=/etc/otel-collector-config.yaml --manager-config=/etc/manager-config.yaml --copy-path=/var/tmp/collector-config.yaml\n     configs:\n       - source: otel-collector-config\n         target: /etc/otel-collector-config.yaml\n@@ -163,29 +155,32 @@ services:\n     environment:\n       - OTEL_RESOURCE_ATTRIBUTES=host.name={{.Node.Hostname}},os.type={{.Node.Platform.OS}}\n       - LOW_CARDINAL_EXCEPTION_GROUPING=false\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n     ports:\n       # - \"1777:1777\"     # pprof extension\n       - \"4317:4317\" # OTLP gRPC receiver\n       - \"4318:4318\" # OTLP HTTP receiver\n     deploy:\n       replicas: 3\n-    depends_on:\n-      - clickhouse\n-      - schema-migrator\n-      - signoz\n-  schema-migrator:\n-    !!merge <<: *common\n-    image: signoz/signoz-schema-migrator:v0.142.0\n-    deploy:\n-      restart_policy:\n-        condition: on-failure\n-        delay: 5s\n-    entrypoint: sh\n+  signoz-telemetrystore-migrator:\n+    !!merge <<: *db-depend\n+    image: signoz/signoz-otel-collector:${OTELCOL_TAG:-v0.142.0}\n+    environment:\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n+    entrypoint:\n+      - /bin/sh\n     command:\n-      - -c\n-      - \"/signoz-schema-migrator sync --dsn=tcp://clickhouse:9000 --up= && /signoz-schema-migrator async --dsn=tcp://clickhouse:9000 --up=\"\n-    depends_on:\n-      - clickhouse\n+    - -c \n+    - |\n+      /signoz-otel-collector migrate bootstrap &&\n+      /signoz-otel-collector migrate sync up &&\n+      /signoz-otel-collector migrate async up\n networks:\n   signoz-net:\n     name: signoz-net\n@@ -205,14 +200,6 @@ configs:\n     file: ../common/clickhouse/custom-function.xml\n   clickhouse-cluster:\n     file: ../common/clickhouse/cluster.xml\n-  signoz-prometheus-config:\n-    file: ../common/signoz/prometheus.yml\n-  # If you have multiple dashboard files, you can list them individually:\n-  # dashboard-foo:\n-  #   file: ../common/dashboards/foo.json\n-  # dashboard-bar:\n-  #   file: ../common/dashboards/bar.json\n-\n   otel-collector-config:\n     file: ./otel-collector-config.yaml\n   otel-manager-config:"
  },
  {
    "sha": "6a5e09b556c188dce7b517591ca174856a778bfe",
    "filename": "deploy/docker/docker-compose.ha.yaml",
    "status": "modified",
    "additions": 30,
    "deletions": 41,
    "changes": 71,
    "blob_url": "https://github.com/SigNoz/signoz/blob/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker%2Fdocker-compose.ha.yaml",
    "raw_url": "https://github.com/SigNoz/signoz/raw/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker%2Fdocker-compose.ha.yaml",
    "contents_url": "https://api.github.com/repos/SigNoz/signoz/contents/deploy%2Fdocker%2Fdocker-compose.ha.yaml?ref=7d51eea14a232c9d4032ac76a8c1887c0138929f",
    "patch": "@@ -62,8 +62,10 @@ x-db-depend: &db-depend\n   depends_on:\n     clickhouse:\n       condition: service_healthy\n-    schema-migrator-sync:\n-      condition: service_completed_successfully\n+    clickhouse-2:\n+      condition: service_healthy\n+    clickhouse-3:\n+      condition: service_healthy\n services:\n   init-clickhouse:\n     !!merge <<: *common\n@@ -181,25 +183,15 @@ services:\n     !!merge <<: *db-depend\n     image: signoz/signoz:${VERSION:-v0.112.0}\n     container_name: signoz\n-    command:\n-      - --config=/root/config/prometheus.yml\n     ports:\n       - \"8080:8080\" # signoz port\n-    #   - \"6060:6060\"     # pprof port\n     volumes:\n-      - ../common/signoz/prometheus.yml:/root/config/prometheus.yml\n-      - ../common/dashboards:/root/config/dashboards\n       - sqlite:/var/lib/signoz/\n     environment:\n       - SIGNOZ_ALERTMANAGER_PROVIDER=signoz\n       - SIGNOZ_TELEMETRYSTORE_CLICKHOUSE_DSN=tcp://clickhouse:9000\n       - SIGNOZ_SQLSTORE_SQLITE_PATH=/var/lib/signoz/signoz.db\n-      - DASHBOARDS_PATH=/root/config/dashboards\n-      - STORAGE=clickhouse\n-      - GODEBUG=netdns=go\n-      - TELEMETRY_ENABLED=true\n-      - DEPLOYMENT_TYPE=docker-standalone-amd\n-      - DOT_METRICS_ENABLED=true\n+      - SIGNOZ_TOKENIZER_JWT_SECRET=secret\n     healthcheck:\n       test:\n         - CMD\n@@ -210,51 +202,48 @@ services:\n       interval: 30s\n       timeout: 5s\n       retries: 3\n-  # TODO: support otel-collector multiple replicas. Nginx/Traefik for loadbalancing?\n   otel-collector:\n     !!merge <<: *db-depend\n     image: signoz/signoz-otel-collector:${OTELCOL_TAG:-v0.142.0}\n     container_name: signoz-otel-collector\n+    entrypoint:\n+    - /bin/sh\n     command:\n-      - --config=/etc/otel-collector-config.yaml\n-      - --manager-config=/etc/manager-config.yaml\n-      - --copy-path=/var/tmp/collector-config.yaml\n+      - -c\n+      - |\n+        /signoz-otel-collector migrate sync check &&\n+        /signoz-otel-collector --config=/etc/otel-collector-config.yaml --manager-config=/etc/manager-config.yaml --copy-path=/var/tmp/collector-config.yaml\n     volumes:\n       - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml\n       - ../common/signoz/otel-collector-opamp-config.yaml:/etc/manager-config.yaml\n     environment:\n       - OTEL_RESOURCE_ATTRIBUTES=host.name=signoz-host,os.type=linux\n       - LOW_CARDINAL_EXCEPTION_GROUPING=false\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n     ports:\n       # - \"1777:1777\"     # pprof extension\n       - \"4317:4317\" # OTLP gRPC receiver\n       - \"4318:4318\" # OTLP HTTP receiver\n-    depends_on:\n-      clickhouse:\n-        condition: service_healthy\n-      schema-migrator-sync:\n-        condition: service_completed_successfully\n-      signoz:\n-        condition: service_healthy\n-  schema-migrator-sync:\n-    !!merge <<: *common\n-    image: signoz/signoz-schema-migrator:${OTELCOL_TAG:-v0.142.0}\n-    container_name: schema-migrator-sync\n-    command:\n-      - sync\n-      - --dsn=tcp://clickhouse:9000\n-      - --up=\n-    depends_on:\n-      clickhouse:\n-        condition: service_healthy\n-  schema-migrator-async:\n+  signoz-telemetrystore-migrator:\n     !!merge <<: *db-depend\n-    image: signoz/signoz-schema-migrator:${OTELCOL_TAG:-v0.142.0}\n-    container_name: schema-migrator-async\n+    image: signoz/signoz-otel-collector:${OTELCOL_TAG:-v0.142.0}\n+    container_name: signoz-telemetrystore-migrator\n+    environment:\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n+    entrypoint:\n+      - /bin/sh\n     command:\n-      - async\n-      - --dsn=tcp://clickhouse:9000\n-      - --up=\n+    - -c \n+    - |\n+      /signoz-otel-collector migrate bootstrap &&\n+      /signoz-otel-collector migrate sync up &&\n+      /signoz-otel-collector migrate async up\n     restart: on-failure\n networks:\n   signoz-net:"
  },
  {
    "sha": "5c0b144ba58e3a2e6e394bc48f90d0a1d6be640b",
    "filename": "deploy/docker/docker-compose.yaml",
    "status": "modified",
    "additions": 26,
    "deletions": 37,
    "changes": 63,
    "blob_url": "https://github.com/SigNoz/signoz/blob/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker%2Fdocker-compose.yaml",
    "raw_url": "https://github.com/SigNoz/signoz/raw/7d51eea14a232c9d4032ac76a8c1887c0138929f/deploy%2Fdocker%2Fdocker-compose.yaml",
    "contents_url": "https://api.github.com/repos/SigNoz/signoz/contents/deploy%2Fdocker%2Fdocker-compose.yaml?ref=7d51eea14a232c9d4032ac76a8c1887c0138929f",
    "patch": "@@ -57,8 +57,6 @@ x-db-depend: &db-depend\n   depends_on:\n     clickhouse:\n       condition: service_healthy\n-    schema-migrator-sync:\n-      condition: service_completed_successfully\n services:\n   init-clickhouse:\n     !!merge <<: *common\n@@ -113,25 +111,15 @@ services:\n     !!merge <<: *db-depend\n     image: signoz/signoz:${VERSION:-v0.112.0}\n     container_name: signoz\n-    command:\n-      - --config=/root/config/prometheus.yml\n     ports:\n       - \"8080:8080\" # signoz port\n-    #   - \"6060:6060\"     # pprof port\n     volumes:\n-      - ../common/signoz/prometheus.yml:/root/config/prometheus.yml\n-      - ../common/dashboards:/root/config/dashboards\n       - sqlite:/var/lib/signoz/\n     environment:\n       - SIGNOZ_ALERTMANAGER_PROVIDER=signoz\n       - SIGNOZ_TELEMETRYSTORE_CLICKHOUSE_DSN=tcp://clickhouse:9000\n       - SIGNOZ_SQLSTORE_SQLITE_PATH=/var/lib/signoz/signoz.db\n-      - DASHBOARDS_PATH=/root/config/dashboards\n-      - STORAGE=clickhouse\n-      - GODEBUG=netdns=go\n-      - TELEMETRY_ENABLED=true\n-      - DEPLOYMENT_TYPE=docker-standalone-amd\n-      - DOT_METRICS_ENABLED=true\n+      - SIGNOZ_TOKENIZER_JWT_SECRET=secret\n     healthcheck:\n       test:\n         - CMD\n@@ -146,43 +134,44 @@ services:\n     !!merge <<: *db-depend\n     image: signoz/signoz-otel-collector:${OTELCOL_TAG:-v0.142.0}\n     container_name: signoz-otel-collector\n+    entrypoint:\n+    - /bin/sh\n     command:\n-      - --config=/etc/otel-collector-config.yaml\n-      - --manager-config=/etc/manager-config.yaml\n-      - --copy-path=/var/tmp/collector-config.yaml\n+      - -c\n+      - |\n+        /signoz-otel-collector migrate sync check &&\n+        /signoz-otel-collector --config=/etc/otel-collector-config.yaml --manager-config=/etc/manager-config.yaml --copy-path=/var/tmp/collector-config.yaml\n     volumes:\n       - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml\n       - ../common/signoz/otel-collector-opamp-config.yaml:/etc/manager-config.yaml\n     environment:\n       - OTEL_RESOURCE_ATTRIBUTES=host.name=signoz-host,os.type=linux\n       - LOW_CARDINAL_EXCEPTION_GROUPING=false\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n     ports:\n       # - \"1777:1777\"     # pprof extension\n       - \"4317:4317\" # OTLP gRPC receiver\n       - \"4318:4318\" # OTLP HTTP receiver\n-    depends_on:\n-      signoz:\n-        condition: service_healthy\n-  schema-migrator-sync:\n-    !!merge <<: *common\n-    image: signoz/signoz-schema-migrator:${OTELCOL_TAG:-v0.142.0}\n-    container_name: schema-migrator-sync\n-    command:\n-      - sync\n-      - --dsn=tcp://clickhouse:9000\n-      - --up=\n-    depends_on:\n-      clickhouse:\n-        condition: service_healthy\n-    restart: on-failure\n-  schema-migrator-async:\n+  signoz-telemetrystore-migrator:\n     !!merge <<: *db-depend\n-    image: signoz/signoz-schema-migrator:${OTELCOL_TAG:-v0.142.0}\n-    container_name: schema-migrator-async\n+    image: signoz/signoz-otel-collector:${OTELCOL_TAG:-v0.142.0}\n+    container_name: signoz-telemetrystore-migrator\n+    environment:\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_DSN=tcp://clickhouse:9000\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_CLUSTER=cluster\n+      - SIGNOZ_OTEL_COLLECTOR_CLICKHOUSE_REPLICATION=true\n+      - SIGNOZ_OTEL_COLLECTOR_TIMEOUT=10m\n+    entrypoint:\n+      - /bin/sh\n     command:\n-      - async\n-      - --dsn=tcp://clickhouse:9000\n-      - --up=\n+    - -c \n+    - |\n+      /signoz-otel-collector migrate bootstrap &&\n+      /signoz-otel-collector migrate sync up &&\n+      /signoz-otel-collector migrate async up\n     restart: on-failure\n networks:\n   signoz-net:"
  }
]
